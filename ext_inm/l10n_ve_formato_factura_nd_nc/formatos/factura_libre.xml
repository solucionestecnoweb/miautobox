<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data> 
  <record id="paperformat_forma_libre" model="report.paperformat">

      <field name="default" eval="True"/>
        <field name="name">A4 Factura Forma Libre</field>
        <field name="default" eval="True"/>
        <field name="format">custom</field>
        <field name="page_height">300</field>
        <field name="page_width">240</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">40</field>
        <field name="margin_bottom">5</field>
        <field name="margin_left">2</field>
        <field name="margin_right">2</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">35</field>
        <field name="dpi">96</field>
</record>

    <template id="report_invoice_with_payments_copy">
            <t t-call="web.html_container">
              <t t-call="web.basic_layout" >
                <div class="page">
                  <table  width="100%">
                 

            <!-- modelo de factura -->
            <tr style="font-size:16px;">
                <t t-if="docs.move_type== 'out_invoice' ">

                  <tr style="font-size:16px;">
                      <td align="left" >Cliente:</td>
                      <td  align="left" ><t t-esc="docs.partner_id.name"/></td>

                     
                      <td align="right">Factura Nº:</td>
                      <td  align="right"><t t-esc="docs.invoice_number_cli"/></td>
                    
                  </tr> 

                  <tr style="font-size:16px;">
                      <td align="left" >R.I.F:</td>
                      <td align="left" ><t t-esc="docs.doc_cedula(docs.partner_id.id)"/></td>

                      <td  align="right">Cond.Pago:</td>
                      <td  align="right"><t t-esc="docs.invoice_payment_term_id.name"/></td>

                     
                  </tr>

                  <tr style="font-size:16px;">
                   
              
                       <td align="left">Dirección:</td>
                       <td align="left" ><t t-esc="docs.partner_id.street"/>;<t t-esc="docs.partner_id.street2"/></td>

                      <td  align="right">Emisión:</td>
                      <td  align="right"><t t-esc="docs.formato_fecha(docs.invoice_date)"/></td>
                  </tr>

                   <tr style="font-size:16px;">
                        <td align="left" >Teléfono:</td>
                        <td align="left" ><t t-esc="docs.partner_id.phone"/></td>

                      <td  align="right">Vecimiento:</td>
                      <td  align="right"><t t-esc="docs.formato_fecha(docs.invoice_date)"/></td>
                   
                  </tr>
                   <tr style="font-size:16px;">
                        <td align="left" ></td>
                        <td align="left" ></td>

                      <td  align="right">O.de Compra/Pedido:</td>
                      <td  align="right"><t t-esc="docs.invoice_origin"/></td>
                   
                  </tr>

              </t>


            <!--formato de nota de credito --> 

            <t t-elif="docs.move_type== 'out_refund' ">

                  <tr style="font-size:16px;">
                      <td align="left" >Cliente:</td>
                      <td  align="left" ><t t-esc="docs.partner_id.name"/></td>

                     
                      <td align="right">Nota de Credito Nº:</td>
                      <td  align="right"><t t-esc="docs.refuld_number_cli"/></td>
                    
                  </tr> 

                  <tr style="font-size:16px;">
                      <td align="left" >R.I.F:</td>
                      <td align="left" ><t t-esc="docs.doc_cedula(docs.partner_id.id)"/></td>

                      <td  align="right">Cond.Pago:</td>
                      <td  align="right"><t t-esc="docs.invoice_payment_term_id.name"/></td>

                     
                  </tr>

                  <tr style="font-size:16px;">
                   
              
                       <td align="left">Dirección:</td>
                       <td align="left" ><t t-esc="docs.partner_id.street"/>;<t t-esc="docs.partner_id.street2"/></td>

                      <td  align="right">Emisión:</td>
                      <td  align="right"><t t-esc="docs.formato_fecha(docs.invoice_date)"/></td>
                  </tr>

                   <tr style="font-size:16px;">
                        <td align="left" >Teléfono:</td>
                        <td align="left" ><t t-esc="docs.partner_id.phone"/></td>

                      <td  align="right">Vecimiento:</td>
                      <td  align="right"><t t-esc="docs.formato_fecha(docs.invoice_date)"/></td>
                   
                  </tr>
                   <tr style="font-size:16px;">
                        <td align="left" ></td>
                        <td align="left" ></td>

                      <td  align="right">O.de Compra/Pedido:</td>
                      <td  align="right"><t t-esc="docs.invoice_origin"/></td>
                   
                  </tr>

              </t>

            <!--Nota de Debito -->
               <t t-elif="docs.move_type== 'out_receipt' ">

                  <tr style="font-size:16px;">
                      <td align="left" >Cliente:</td>
                      <td  align="left" ><t t-esc="docs.partner_id.name"/></td>

                     
                      <td align="right">Nota de Débito:</td>
                      <td  align="right"><t t-esc="docs.refuld_number_cli"/></td>
                    
                  </tr> 

                  <tr style="font-size:16px;">
                      <td align="left" >R.I.F:</td>
                      <td align="left" ><t t-esc="docs.doc_cedula(docs.partner_id.id)"/></td>

                      <td  align="right">Cond.Pago:</td>
                      <td  align="right"><t t-esc="docs.invoice_payment_term_id.name"/></td>

                     
                  </tr>

                  <tr style="font-size:16px;">
                   
              
                       <td align="left">Dirección:</td>
                       <td align="left" ><t t-esc="docs.partner_id.street"/>;<t t-esc="docs.partner_id.street2"/></td>

                      <td  align="right">Emisión:</td>
                      <td  align="right"><t t-esc="docs.formato_fecha(docs.invoice_date)"/></td>
                  </tr>

                   <tr style="font-size:16px;">
                        <td align="left" >Teléfono:</td>
                        <td align="left" ><t t-esc="docs.partner_id.phone"/></td>

                      <td  align="right">Vecimiento:</td>
                      <td  align="right"><t t-esc="docs.formato_fecha(docs.invoice_date)"/></td>
                   
                  </tr>

                  <tr style="font-size:16px;">
                        <td align="left" ></td>
                        <td align="left" ></td>

                      <td  align="right">O.de Compra/Pedido:</td>
                      <td  align="right"><t t-esc="docs.invoice_origin"/></td>
                   
                  </tr>
              </t>

          </tr>
</table>

  <br/>

      <table width="100%" class="table table-borderless m-0" style="font-size:16px;">
   
                    <thead  style="table-layout: fixed; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: black; border-top-width: 1px;" >
                      <tr   align="center" style="font-size:16px;">
                        <td>Cod.</td>
                        <td>Cantidad</td>
                        <td>Descripción</td>
                        <td>I.V.A %</td>
                        <td>Precio Neto</td>
                        <td>Descuento %</td>
                        <td>Total</td>
                       
                      </tr>
                    </thead>

 

                    <t t-set="acum_subtotal" t-value="0"/>
                    <t t-set="acum_descuento" t-value="0"/>
                    <t t-set="acum_alicuota_general" t-value="0"/>
                    <t t-set="acum_alicuota_reducida" t-value="0"/>
                    <t t-set="acum_alicuota_adicional" t-value="0"/>
                    <t t-set="total_factura" t-value="0"/>


                    <tbody>
                    <t t-foreach="docs.invoice_line_ids" t-as="o">
                    <tr style="font-size:16px;">
                      <td><div align="center"><t t-esc="o.product_id.default_code"/></div></td>
                      <td><div align="center"><t t-esc="o.integer_format(o.quantity)"/></div></td>
                      <td><div align="center"><t t-esc="o.product_id.name"/> </div></td>
                      <td><div align="center"><t t-esc="o.tax_ids.name"/> </div></td>
                      <td><div align="center"><t t-esc="o.float_format(o.fact_div(o.price_unit))"/>&amp;nbsp;Bs</div></td>
                      <td><div align="center">
                      <t t-if="o.discount">
                        <t t-esc="o.discount"/> 
                      </t>
                      <t t-else="">
                          <span>---</span>
                      </t>
                      <t t-set="acum_descuento" t-value="acum_descuento+o.discount /100 *o.price_unit *o.quantity"/>
                      </div></td>
                      <td><div align="center"><t t-esc="o.float_format(o.fact_div(o.price_subtotal))"/>&amp;nbsp;Bs

                          <t t-set="acum_subtotal" t-value="acum_subtotal+o.price_subtotal "/></div></td>
                      <t t-if="o.tax_ids.aliquot== 'general' ">
                        <t t-set="acum_alicuota_general" t-value="acum_alicuota_general+(o.price_total-o.price_subtotal)"/>
                      </t>
                      <t t-if="o.tax_ids.aliquot== 'reduced' ">
                        <t t-set="acum_alicuota_reducida" t-value="acum_alicuota_reducida+(o.price_total-o.price_subtotal)"/>
                      </t>
                      <t t-if="o.tax_ids.aliquot== 'additional' ">
                        <t t-set="acum_alicuota_adicional" t-value="acum_alicuota_adicional+(o.price_total-o.price_subtotal)"/>
                      </t>

                    </tr>
                    </t>

                    </tbody>


</table>

             <br/>
             <br/>


           
            <div class="container" >
              <div class="border-dark">
              
                <hr style="background-color: black;width=1%"></hr>
                     <table width="100%" style="font-size:16px;" > 

                        
                            <tr >
                                    <td class="text-left">Subtotal Exento:</td>
                                    <td class="text-left"><t t-esc="(docs.fact_div_line(docs.amount_exento))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td>
                                    <td class="text-right">Descuento:&amp;nbsp;&amp;nbsp; </td>
                                    <td class="text-right"><span><t t-esc="(docs.fact_div_line(acum_descuento))" t-options='{"widget": "float", "precision": 2}' />&amp;nbsp;Bs</span></td>
                                    <td class="text-right">Subtotal:</td>
                                    <td class="text-right"><t t-esc="(docs.fact_div_line(docs.amount_untaxed))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td>
                            </tr>
                         
                          
                              
                               <tr >
                                    <td class="text-center"></td>
                                    <td class="text-center"></td>
                                    <td class="text-center"></td>
                                    <td class="text-center"></td>
                                    <td class="text-right">Base Imponible: </td>
                                    <td class="text-right"><t t-esc="(docs.fact_div_line(docs.amount_imponible))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td>
                                </tr>

                               <tr>
                                <t t-if="docs.move_type== 'out_invoice' or docs.move_type == 'out_receipt'">
                                    <td class="text-left">Recibido en Divisas:</td>
                                    <td class="text-left"><t t-esc="(docs.fact_div_line1(docs.pago_usd_eq))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;$</td>
                                    <td class="text-right">Base Calculo IGTF en Bs:&amp;nbsp;&amp;nbsp;</td>
                                    <td class="text-right"><t t-esc="(docs.fact_div_line(docs.pago_divisa))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td>
                                    <td class="text-right">Impuesto I.V.A 16%: </td>
                                    <td class="text-right"><t t-esc="(docs.fact_div_line(acum_alicuota_general))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td> 
                                </t> 

                                 <t t-if="docs.move_type== 'out_refund' ">
                                    <td class="text-left"></td>
                                    <td class="text-left"></td>
                                    <td class="text-right"></td>
                                    <td class="text-right"></td>
                                    <td class="text-right">Impuesto I.V.A 16%: </td>
                                    <td class="text-right"><t t-esc="(docs.fact_div_line(acum_alicuota_general))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td> 
                                </t> 

                               </tr>


                              <tr>
                              <t t-if="docs.move_type== 'out_invoice' or docs.move_type == 'out_receipt'">
                                <td class="text-left">Tasa:</td>
                                <td class="text-left"><t t-esc="docs.tasa_del_dia" t-options='{"widget": "float", "precision": 2}'/></td>
                                <td class="text-right">Impuesto IGTF 3%:&amp;nbsp;&amp;nbsp;</td>
                                <td class="text-right"><t t-esc="(docs.fact_div_line(docs.impuesto_igtf))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td>
                                <td class="text-right">Total Factura: </td>
                                <td class="text-right"><t t-esc="(docs.fact_div_line(docs.total_pagar))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td> 

                              </t> 
                                <t t-if="docs.move_type== 'out_refund' ">
                                  <td class="text-left">Tasa:</td>
                                  <td class="text-left"><t t-esc="docs.tasa_del_dia" t-options='{"widget": "float", "precision": 2}'/></td>
                                  <td class="text-right"></td>
                                  <td class="text-right"></td>
                                  <td class="text-right">Total Factura: </td>
                                  <td class="text-right"><t t-esc="(docs.fact_div_line(docs.total_pagar))" t-options='{"widget": "float", "precision": 2}'/>&amp;nbsp;Bs</td> 

                              </t> 

                              </tr>
                    
                    </table>
                    <br/>
                    <br/>
                    <tabla style="font-size:16px;">
                      <tr>
                        <!--aplique cuando es una nota de credito  -->
                         <t t-if="docs.move_type== 'out_refund' ">
                          <td class="text-left">Aplica a:</td>
                          <td class="text-right">&amp;nbsp;<t t-esc="docs.invoice_number_cli"/></td>   
                         </t>
                         <!--aplique cuando es una nota de debito  -->
                          <t t-elif="docs.move_type== 'out_receipt' ">
                            <td class="text-left">Aplica a:</td>
                            <td class="text-right">&amp;nbsp;<t t-esc="docs.invoice_number_cli"/></td>   
                         </t>
                      </tr>
                    </tabla>


                    <br/>
                    <br/>
                    <table>
                      <tr>
                       <t t-if="docs.move_type== 'out_invoice' or docs.move_type == 'out_receipt'">      
                          <td><div align="justify" style="font-size:16px;">Se percibirá el IGTF Alicuota de 3% sobre el pago que se realice mediante las formas descritas en el artículo 4, numeral 6 de la Ley del I.G.T.F, según providencia SNAT/2022/000013</div></td>
                      </t>            
                      </tr>
                    </table>
            </div>               
        </div> 
      
                </div>
              </t>
            </t>
    </template>


    <report
            id="account_facturas"
            model="account.move"
            string="Factura/NC/ND"
            report_type="qweb-pdf"
            name="l10n_ve_formato_factura_nd_nc.report_invoice_with_payments_copy"
            file="l10n_ve_formato_factura_nd_nc.report_invoice_with_payments_copy"
            paperformat="l10n_ve_formato_factura_nd_nc.paperformat_forma_libre"
        />

  </data>
</odoo>