<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_saledetails_inh" inherit_id="point_of_sale.report_saledetails">
            <xpath expr="//div[hasclass('page')]" position="replace">
                <div class="page">
                    <div>
                        <strong>Cajas:</strong>
                        <br />
                        <span t-esc="' , '.join([item['name'] for item in sessions])" />
                    </div>
                    <div class="text-center">
                        <h2>Detalles de Ventas</h2>

                        <strong>
                            <t t-esc="date_start" t-options="{'widget': 'datetime'}" />
                            -
                            <t t-esc="date_stop" t-options="{'widget': 'datetime'}" />
                        </strong>
                    </div>

                    <!-- Orderlines -->
                    <t t-if="not view_product">

                        <h3>Pagos</h3>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Total</th>
                                    <th>Total $</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach='payments' t-as='payment'>
                                    <td>
                                        <t t-esc="payment['name']" />
                                    </td>
                                    <td>
                                        <t t-esc="payment['total']" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="payment['total'] / rate" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <br />

                        <h3>Impuestos</h3>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Importe impuesto</th>
                                    <th>Importe impuesto $</th>
                                    <th>Importe base</th>
                                    <th>Importe base $</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach='taxes' t-as='tax'>
                                    <td>
                                        <t t-esc="tax['name']" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['tax_amount']" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['tax_amount'] / rate" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['base_amount']" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['base_amount'] / rate" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td> 
                                </tr>
                            </tbody>
                        </table>

                        <br />
                        <br />

                        <strong>
                            Total:
                            <t t-esc='total_paid' t-options="{'widget': 'float', 'precision': currency_precision}" />
                        </strong>
                        <br />
                        <br />

                        <strong>
                            Total $:
                            <t t-esc='total_paid / rate' t-options="{'widget': 'float', 'precision': currency_precision}" />
                        </strong>

                    </t>
                    <t t-else="">
                        <h3>Productos</h3>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Precio Unitario</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach='products' t-as='line'>
                                    <t t-set="internal_reference" t-value="line['code'] and '[%s] ' % line['code'] or ''" />
                                    <td>
                                        <t t-esc="internal_reference" />
                                        <t t-esc="line['product_name']" />
                                    </td>
                                    <td>
                                        <t t-esc="line['quantity']" />
                                        <t t-if='line["uom"] != "Units"'>
                                            <t t-esc='line["uom"]' />
                                        </t>
                                    </td>
                                    <td>
                                        <t t-esc='line["price_unit"]' />
                                        <t t-if='line["discount"] != 0'>
                                            Disc:
                                            <t t-esc='line["discount"]' />
                                            %
                                        </t>
                                    </td>
                                    <td>
                                        <t t-set="acum_unit" t-value="line['quantity'] * line['price_unit']"/>
                                        <t t-esc='acum_unit' t-options='{"widget": "float", "precision": 2}'/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <br />

                        <h3>Pagos</h3>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Total</th>
                                    <th>Total $</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach='payments' t-as='payment'>
                                    <td>
                                        <t t-esc="payment['name']" />
                                    </td>
                                    <td>
                                        <t t-esc="payment['total']" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="payment['total'] / rate" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <br />

                        <h3>Impuestos</h3>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Importe impuesto</th>
                                    <th>Importe impuesto $</th>
                                    <th>Importe base</th>
                                    <th>Importe base $</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach='taxes' t-as='tax'>
                                    <td>
                                        <t t-esc="tax['name']" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['tax_amount']" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['tax_amount'] / rate" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['base_amount']" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td>
                                    <td>
                                        <t t-esc="tax['base_amount'] / rate" t-options="{'widget': 'float', 'precision': currency_precision}" />
                                    </td> 
                                </tr>
                            </tbody>
                        </table>

                        <br />
                        <br />

                        <strong>
                            Total:
                            <t t-esc='total_paid' t-options="{'widget': 'float', 'precision': currency_precision}" />
                        </strong>
                        <br />
                        <br />
                        <strong>
                            Total $:
                            <t t-esc='total_paid / rate' t-options="{'widget': 'float', 'precision': currency_precision}" />
                        </strong>

                    </t>

                </div>
            </xpath>
        </template>

    
    </data>
</odoo>